I would like to write a specification for a new software service.

The service will be called code-story. The service is a resource that will be used to provide advanced code base understanding to LLM agents using MCP. The service will feature a code ingestion process, a neo4j graph database service, an MCP service, a CLI, an OpenAI client, a configuration module, and a typescript GUI. The ingestion process will make use of an extensible pipeline for processing.

The specification shall be written in Markdown. There will be an overall specification and then detailed specifications for each major component. The specifications shall include detaield descriptions, architectural notes, technical stack, detailed user stores, test criteria, example of api usage for each module or component, and enough instructions to allow the one shot cogeneration of the entire component or module from a single LLM prompt.

The service will use Blarify (https://github.com/blarApp/blarify) to ingest the codebase from either a local directory or from a git repository. It will use blarify to parse the code and populate the graph database.

The ingestion process will then use the processed graph of the code to compute an acyclic graph of the code modules and will visit all of the leaf nodes and use an LLM model such as o3 or o1 in the azure OpenAI service to compute a summary of the purpose and api of each leaf node code module. One the summary is computed for each leaf node it will walk up the tree to the parent nodes compute summaries of the parent nodes (using what it learned about the leaf nodes as context, ascending until all the nodes have been summarized). Each summary will be a new node in the graph with an edge linking to the graph nodes for the module it describes. The ingestion shall also create nodes with aggregate summaries for larger modules or components and a summary for the repository as a whole.  The ingestion process will also create a set of graph nodes and edges representing the filesystem layout of the code repo and will link each of those nodes with the associated nodes and symbols from the AST. During the ingestion process the service will maintain a status indicator that can be polled for information on the ingestion each ingestion should also include metadata such as the GitHub repo metadata and version information as well as the most recent commit info for each file.


